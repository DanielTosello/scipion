<!DOCTYPE html>
<html lang='es'>
	<head>
		<title>Scipion File Upload</title>	
		<meta charset="utf-8">
		<link rel="icon" type="image/png" href={{favicon}} />

		<!-- CSS -->
		<link href="{{general_css}}" rel="stylesheet" type="text/css">
		<link href={{form_css}} rel="stylesheet" type="text/css">
		<link href="{{jquery_ui_css}}" rel="stylesheet" type="text/css">
		<link href="{{font_awesome}}" rel="stylesheet" type="text/css">
		<link href={{messi_css}} rel="stylesheet" type="text/css">
		
		<style type="text/css">
			.ui-state-active {
				{% if visualize == 1 %}
				background: #6E6E6E !important;
				{% else %}
				background: Firebrick !important;
				{% endif %}
				font-size: 0.9em !important;
				font-weight: bold !important;
				text-align: center !important;
				padding: 2px !important;
			}
			.ui-tabs-anchor{
				color: #000 !important;
				padding: .3em 1em !important;
			}
			.ui-state-active .ui-tabs-anchor{
				color: white !important;
			} 
			
			.ui-progressbar {
				position: relative;
		   	}
		  	.progress-label {
			    position: absolute;
			    left: 50%;
			    top: 4px;
			    font-weight: bold;
			    text-shadow: 1px 1px 0 #fff;
			 }
		</style>
		
		<!-- JS -->
		<script src={{jquery}} type="text/javascript"></script>
		<script src={{messi_js}} type="text/javascript"></script>
		<script src={{utils}} type="text/javascript"></script>
		<script src={{protocol_form_utils}} type="text/javascript"></script>
		<script src="{{jquery_ui}} "type="text/javascript"></script>
		<script src="{{jquery_browser}} "type="text/javascript"></script>
		
		<script>
			function launchUpload(){
				var msg = "</td><td class='content' value='"
					msg += "'>The file will be <strong>UPLOADED</strong> into the path <strong>{{project_folder}}/Uploads/</strong>. "
					msg += "Do you really want to continue?</td></tr></table>";
				warningPopup('Confirm UPLOAD',msg, 'launchSubmitUpload')
			}
			
			function launchSubmitUpload(){
				$("#progressbar").show()
   				$('#uploadForm').submit();
			}
			
			$(function() {
				//tabs				
				$("#tabs").tabs();
				
				//progressbar
				$("#progressbar").progressbar({
					value: false
			    });
			  });
			
			 
			 $(document).ready(function() {
				 var project_folder = "{{project_folder}}/Uploads"
				 $.ajax({
					type : "GET",
					url : "/getPath/?path="+ project_folder,
					dataType : "json",
					async: false,
					success : function(json) {
						$.each(json, function(key, value) {
							var icon = "<td><img src='"+ value.icon +"' /></td>"
							var name = "<td><a href='#'>"+ value.name +"</a></td>"
								    $("tr#listFiles").append("<tr>" +icon + name + "</tr>")
							});
						}
					});
				 });	
	  	</script>		  	
	</head>
	<body>
		<div>
			<img src='{{logo_scipion_small}}' style="margin:5px;width:auto;height:2.5em;float:left;"/>
			<h3 id="protName" style="">
					Scipion File Upload 
			</h3>
		</div>
		
		<div id="tabs">
			<ul>
				<li>
					<a href="#tabs-1">File Upload</a>
				</li>
				<li>
					<a href="#tabs-2">List Files</a>
				</li>
			</ul>
			
		<!-- FILE UPLOAD> -->
			 <div id="tabs-1">
	 			<div class="box">
					<form id="uploadForm" action="/doUpload/" method="post" enctype="multipart/form-data">
					{% csrf_token %}
						Path: <br /><strong>{{project_folder}}/Uploads</strong>							
						<table class="section">
							<tr>
								<td id="inputName" class="normal">
									<strong>{{form.docfile.label_tag}}</strong>
								</td>
								<td colspan="3">
									<p>{{form.non_field_errors}}</p>
									<p>{{form.docfile.help_text}}</p>
									<p>
										{{form.docfile.errors}}
										{{form.docfile}}
									</p>
								</td>
								<td class="ico">
									<a class="fa fa-question-circle" href="javascript:infoPopup('Documentation','{{msg.TEXT_HELP}}');"></a>
								</td>
							</tr>
						</table>
						<div style="float:right;">
							<a href="javascript:launchUpload();" class="btn buttonGrey">
								<i class="fa fa-cogs"></i>
								Upload
							</a>
						</div>
					</form>
				</div>
			</div>
			
		<!-- LIST FILES -->
			<div id="tabs-2">
	 			<div class="box">
	 				Path: <br /><strong>{{project_folder}}/Uploads</strong>	
					<table class="section">
						<tr id="listFiles">
							<!-- List of uploaded documents -->
						</tr>
					</table>
				</div>
			</div>
		</div>
		<br />
		<div id="progressbar" style='display:none;'>
			<div class="progress-label">Uploading ... </div>	
		</div>
		<div class="boxBottom">
			<a href="javascript:window.close()" class="btn buttonGrey"><i class="fa fa-times"></i>{{msg.LABEL_BUTTON_CLOSE}}</a>
		</div>
	</body>
</html>
