{% extends 'showj_base.html' %} 
		
{% block head %}
	<script type="text/javascript">
	var hoverElement;
	
	$(document).ready(function(){
		setImageSize(true)
		initializeImageLoad()
		initializeImageEvents()
		initializeWindowLoadEvents()
		initializeGoToEvents()
	});
	
	
	function initializeImageLoad(){
		$('.tableImages').waypoint(function(direction){
			$(this).attr("src", $(this).data('real_src').concat($("#id_mirrorY").is(':checked')?"&mirrorY":""))
		}, {
			triggerOnce:true,
			offset: '150%'
/* 			offset: function() {
		        return $.waypoints('viewportHeight');
		    }
 */		});
	}

	function initializeGoToEvents(){
		$('#id_goto').click(function(){
			updateSelection();	
		});
		
		$('#id_goto').change(function(){
			updateSelection();
		});
			
 		$('#id_goto').keyup(function(e){
 			var code = e.keyCode || e.which; 
			  	if (code  == 13) {               
			  		updateSelection();
			  	}
		});	 
	}
	
	function updateSelection(){
		$(".img_container").each(function(){
			$(this).removeClass('image_selected')
		});	
		$("#img_container___"+$('#id_goto').val()).addClass("image_selected")
	}
	
	//Show enabled/disabled image and title on hover
	function initializeImageEvents(){
		$(".img_container").hover(
			function(e){
				if ($(this).hasClass("image_selected") && $("#multipleSelectionTool").css('display')!="block"){
					hoverElement=$(this).attr("id")
										
					$("#multipleSelectionTool").css('left',e.pageX)
					$("#multipleSelectionTool").css('top',e.pageY)
					$("#multipleSelectionTool").data('img_container_id',$(this).attr("id"))
					$("#multipleSelectionTool").fadeIn('slow')
				}
				else{
					if (!$(this).find(".enabledGallery").hasClass("selected")){
						$(this).find(".enabledGallery").fadeIn('slow')
					}
				}
			},
			function(){
				if ($(this).hasClass("image_selected") && hoverElement==$(this).attr("id")){
					$("#multipleSelectionTool").delay(1000).fadeOut('slow')
				}
				
				if (!$(this).find(".enabledGallery").hasClass("selected")){
					$(this).find(".enabledGallery").fadeOut('slow')
				}
			})
			
		$(".img_container").click(
			function(e){
				element_id=parseInt($(this).attr("id").split("___")[1]);
	
				if (e.shiftKey){
					prev_element_id=parseInt($('#id_goto').val())
					
					if (prev_element_id < element_id){
						initialIndex = prev_element_id
						endIndex = element_id
					}
					else{
						initialIndex = element_id
						endIndex = prev_element_id
					}
					
					for (var x=initialIndex; x<=endIndex; x++){
						$("#img_container___"+x).addClass("image_selected")
					}
				}
				else{
					if (!e.ctrlKey && !e.metaKey){
						$(".img_container").each(function(){
							$(this).removeClass('image_selected')
						});	
					}
					$("#img_container___"+element_id).toggleClass("image_selected")
				}
				$('#id_goto').val(element_id);
			})	
	}
	
	function initializeWindowLoadEvents(){
		$(window).load(
		function(){
			if ($("#id_colRowMode").val() == 'On' && $("#id_mode").val() == 'gallery'){
				updateMainContainerDim($("#id_cols").val())
			}
		})
	}
	</script>
	<script type="text/javascript">
	function enableDisableImage(element, enableDisable){
		if (enableDisable=='enable'){
			$(element).removeClass("selected")
		}
		else if (enableDisable=='disable'){
			$(element).addClass("selected")
		}
		else{
			$(element).toggleClass("selected")
		}
		
		
		if ($(element).hasClass("selected")){element_value = 0}
		else{element_value = 1}
		
		/*Keep changes in global variable */
		if ($("#saveButton").hasClass("saveOff")){
			$("#saveButton").toggleClass("saveOn").toggleClass("saveOff")
		}
			
		changes[$(element).attr("id")]=element_value
	}
	</script>
	<script type="text/javascript">
	function multipleEnableDisableImage(mode){
		if (mode=='enable'){
			$(".image_selected").each(function(){
				enableDisableImage($(this).find(".enabledGallery"), 'enable')
				$(this).find(".enabledGallery").fadeOut('fast')
			})
		}
		else{
			$(".image_selected").each(function(){
				enableDisableImage($(this).find(".enabledGallery"), 'disable')
				$(this).find(".enabledGallery").fadeIn('fast')
			})
		}
	}
	</script>
	<script type="text/javascript">
	function multipleSelect(mode){
		element_id=parseInt($("#multipleSelectionTool").data('img_container_id').split("___")[1]);
		$(".img_container").each(function(){
			if (mode=='all' || (mode=='from' && $(this).attr('id').split("___")[1]>element_id) || (mode=='to' && $(this).attr('id').split("___")[1]<element_id) ){
				$(this).addClass("image_selected")
			}	
		})
	}
	</script>
{% endblock %}

{% block content_menu %}
{% endblock %}

{% block content_view %}	

	<!-- Napa de Luxe -->
 	{% for columnLayout in tableLayoutConfiguration.columnsLayout %}
		{% if columnLayout == form.labelsToRenderComboBox.value %}
			{% for row in tableDataset.getRows %}
				{% for cell in row %}
					{% if forloop.counter0 == forloop.parentloop.parentloop.counter0 %} 
						<div class="img_container" id="img_container___{{row.0}}">
							<div class="img_inner_container">
								<img class="tableImages" title="{{cell}}" data-real_src="/get_image/?image={{cell}}"/>
								<img class="enabledGallery
								{% if row.enabled == 0 %}
								selected
								{% endif %}
								" src="/resources/showj/enabled_gallery.png" id="enabled___{{row.0}}" onclick="enableDisableImage(this);" 
								{% if row.enabled == 0 %} 
								style="display:block;"
								{% endif %}	
								/>
							</div>
							<div id="column_label">{{row.0}}</div> 
						</div>
					
					{% endif %}		
				{% endfor %}
			{% endfor %}
		{% endif %}
	{% endfor %}	
	
<!-- 	{% for row in tableDataset.getRows %}
 	
		<div class="img_container" id="img_container___{{row.0}}">
			<div class="img_inner_container">
				<img class="tableImages" title="{{cell}}" data-real_src="/get_image/?image={{cell}}"/>
				<img class="enabledGallery" src="/resources/showj/enabled_gallery.png" id="{{form.labelsToRenderComboBox.value}}___{{forloop.parentloop.counter0}}" onclick="enableDisableImage(this);"/>
			</div>
			<div id="column_label">{{forloop.parentloop.counter}}</div> 
		</div>
	{% endfor %} -->		
		
			
{% endblock %}
